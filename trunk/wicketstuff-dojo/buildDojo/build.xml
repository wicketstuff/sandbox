<project name="BuildDojo" default="makeMyDojo">

	<!-- all properties are in build.properties -->
	<property file="build.properties" />
	
	<!--classpath-->
    <path id="project.classpath">
        <pathelement location="${svnjavahl.jar}" />
        <pathelement location="${svnant.jar}" />
        <pathelement location="${svnClientAdapter.jar}" />
        <pathelement location="${jakartaRegexp.jar}" /> 
        <pathelement location="${commonsLang.jar}" />
    </path>
  
     <!-- load the svn task -->
    <taskdef resource="svntask.properties" classpathref="project.classpath"/>
	
	<target name="clean">
		<echo message="Cleaning..."/>
		<delete dir="dojo"/>
		<delete dir="myRelease"/>
	</target>
    
	<!-- Checkout dojo -->
	<target name="checkout" depends="clean">
		<echo message="Checking out dojo from ${dojo.svn.url} with user anonymous"/>
	    <svn>
	      <checkout url="${dojo.svn.url}" destPath="dojo/${dojo.release}" />
	    </svn>
	</target>
	
	<target name="patch" depends="checkout">
		<patch strip="0"  patchfile="${patches.path}/${dojo.release}/calendarFr.2376.patch" dir="./dojo/${dojo.release}"/>
		<patch strip="0"  patchfile="${patches.path}/${dojo.release}/DropDownDateTimePicker.2463.patch" dir="./dojo/${dojo.release}"/>
		<patch strip="0"  patchfile="${patches.path}/${dojo.release}/DropDownDateTimePicker.2568.patch" dir="./dojo/${dojo.release}"/>
		<patch strip="0"  patchfile="${patches.path}/${dojo.release}/FloatingPane.2623.patch" dir="./dojo/${dojo.release}"/>
		<patch strip="0"  patchfile="${patches.path}/${dojo.release}/FloatingPane.2697.patch" dir="./dojo/${dojo.release}"/>
		<patch strip="0"  patchfile="${patches.path}/${dojo.release}/HtmlDragManager.xxxx.patch" dir="./dojo/${dojo.release}"/>
		<patch strip="0"  patchfile="${patches.path}/${dojo.release}/RichText.2492.patch" dir="./dojo/${dojo.release}"/>
		<patch strip="0"  patchfile="${patches.path}/${dojo.release}/SplitContainer.2296.patch" dir="./dojo/${dojo.release}"/>
		<patch strip="0"  patchfile="${patches.path}/${dojo.release}/TabContainer.xxxx.patch" dir="./dojo/${dojo.release}"/>
		<patch strip="0"  patchfile="${patches.path}/${dojo.release}/TimePicker.xxxxx.patch" dir="./dojo/${dojo.release}"/>
	</target>
	
	<target name="buildDojo" depends="patch">
		<!-- copy wicket widgets -->
		<copydir dest="./dojo/dojo-wicket" src="../src/main/java/org/wicketstuff/dojo/dojo-wicket"/>
		<exec command="ant clean release intern-strings -DprofileFile=../../../${profile.path}" dir="./dojo/${dojo.release}/buildscripts"/>
		<!-- todo why task does not work asked with ant??? -->
		<!--ant dir="./dojo/${dojo.release}/buildscripts" target="clean"/>
		<ant dir="./dojo/${dojo.release}/buildscripts" target="release">
			 <property name="profileFile" value="../../../${profile.path}"/>
		</ant-->
		<copydir dest="./dojo/${dojo.release}/release/dojo-wicket" src="../src/main/java/org/wicketstuff/dojo/dojo-wicket"/>
	</target>
	
    <!-- Main task to build your custom dojo build -->
    <target name="makeMyDojo" depends="buildDojo">
		<echo message="Compiling your custom dojo distribution..."/>
    	<copydir src="./dojo/${dojo.release}/release/" dest="myRelease"/>
    </target>

</project> 